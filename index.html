<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š ×¡×¤×¨×™×™×ª Code Snippets - ××“×¨×™×š ××§×™×£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #48bb78;
            --bg-main: #f7fafc;
            --bg-card: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border: #e2e8f0;
            --code-bg: #2d3748;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-main);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .search-container {
            padding: 30px 40px;
            background: white;
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .search-box {
            width: 100%;
            padding: 15px 50px 15px 20px;
            font-size: 1.1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            outline: none;
            transition: all 0.3s;
            direction: rtl;
        }

        .search-box:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 60px;
            top: 48px;
            font-size: 1.5rem;
            color: var(--text-secondary);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat {
            background: var(--bg-main);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .stat strong {
            color: var(--primary);
            font-weight: 700;
        }

        .content {
            display: flex;
            gap: 0;
        }

        .sidebar {
            width: 300px;
            background: white;
            border-left: 1px solid var(--border);
            padding: 30px 20px;
            max-height: calc(100vh - 280px);
            overflow-y: auto;
            position: sticky;
            top: 180px;
        }

        .sidebar h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.1rem;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }

        .category-list {
            list-style: none;
        }

        .category-list li {
            margin-bottom: 8px;
        }

        .category-list a {
            color: var(--text-secondary);
            text-decoration: none;
            display: block;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .category-list a:hover {
            background: var(--bg-main);
            color: var(--primary);
            transform: translateX(-3px);
        }

        .main-content {
            flex: 1;
            padding: 40px;
        }

        .category {
            margin-bottom: 50px;
        }

        .category-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .category-header h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .category-header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .snippet {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .snippet:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .snippet-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            gap: 15px;
        }

        .snippet-title {
            color: var(--primary);
            font-size: 1.3rem;
            font-weight: 700;
            flex: 1;
        }

        .snippet-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .badge.python { background: #3776ab; }
        .badge.javascript { background: #f7df1e; color: #000; }
        .badge.telegram { background: #0088cc; }
        .badge.database { background: #336791; }
        .badge.react { background: #61dafb; color: #000; }
        .badge.mongodb { background: #47a248; }

        .snippet-description {
            background: #f0f4f8;
            padding: 12px 18px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-right: 4px solid var(--secondary);
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .snippet-location {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }

        .code-container {
            position: relative;
        }

        .copy-button {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-primary);
            transition: all 0.2s;
            z-index: 10;
        }

        .copy-button:hover {
            background: white;
            transform: scale(1.05);
        }

        .copy-button.copied {
            background: var(--secondary);
            color: white;
        }

        pre {
            background: var(--code-bg);
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9rem;
            line-height: 1.5;
            direction: ltr;
            text-align: left;
        }

        code {
            font-family: 'Courier New', Courier, monospace;
        }

        .keyword { color: #c792ea; }
        .string { color: #c3e88d; }
        .comment { color: #676e95; font-style: italic; }
        .function { color: #82aaff; }

        footer {
            background: var(--code-bg);
            color: white;
            text-align: center;
            padding: 30px;
            margin-top: 50px;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .no-results h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        @media (max-width: 1024px) {
            .content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: none;
                position: static;
                border-left: none;
                border-bottom: 1px solid var(--border);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            header h1 {
                font-size: 1.8rem;
            }

            .main-content {
                padding: 20px;
            }

            .search-icon {
                left: 30px;
                top: 48px;
            }

            .stats {
                gap: 10px;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        .highlight {
            background-color: yellow;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š ×¡×¤×¨×™×™×ª Code Snippets ×”××§×™×¤×”</h1>
            <p>××•×¡×£ ××œ× ×©×œ ×ª×‘× ×™×•×ª ×§×•×“ ××•×›× ×•×ª ×œ×©×™××•×© ××¤×¨×•×™×§×˜×™ ×”×‘×•×˜×™× ×‘×˜×œ×’×¨×</p>
        </header>

        <div class="search-container">
            <div style="position: relative;">
                <input type="text" class="search-box" id="searchInput" placeholder="×—×¤×© ×¡× ×™×¤×˜ ×œ×¤×™ × ×•×©×, ×©×¤×”, ××• ××™×œ×ª ××¤×ª×—..." />
                <span class="search-icon">ğŸ”</span>
            </div>
            <div class="stats">
                <div class="stat">ğŸ“¦ ×¡×”×´×› <strong id="totalSnippets">0</strong> ×¡× ×™×¤×˜×™×</div>
                <div class="stat">ğŸ“‚ <strong id="totalCategories">0</strong> ×§×˜×’×•×¨×™×•×ª</div>
                <div class="stat">ğŸ’» <strong>Python, JavaScript, SQL</strong></div>
            </div>
        </div>

        <div class="content">
            <aside class="sidebar">
                <h3>ğŸ“‘ ×ª×•×›×Ÿ ×¢× ×™×™× ×™×</h3>
                <ul class="category-list" id="categoryNav">
                    <!-- Generated by JS -->
                </ul>
            </aside>

            <main class="main-content" id="mainContent">
                <!-- CATEGORY: Telegram Bot UI -->
                <div class="category" data-category="telegram-ui">
                    <div class="category-header">
                        <h2>ğŸ¤– ×ª×¤×¨×™×˜×™× ×•×××©×§×™ ××©×ª××© ×‘×‘×•×˜</h2>
                        <p>×™×¦×™×¨×ª ×ª×¤×¨×™×˜×™×, ×›×¤×ª×•×¨×™×, ×•-dialogs ××™× ×˜×¨××§×˜×™×‘×™×™×</p>
                    </div>

                    <div class="snippet" data-tags="telegram buttons inline-keyboard python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×ª×¤×¨×™×˜ ×¤×¢×•×œ×•×ª ×¢×œ ×§×•×‘×¥ (Multi-Row Grid)</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×™×¦×™×¨×ª ×ª×¤×¨×™×˜ ×¢× ××¡×¤×¨ ×©×•×¨×•×ª ×©×œ ×›×¤×ª×•×¨×™×, ×××•×¨×’× ×™× ×œ×¤×™ ×¤×•× ×§×¦×™×•× ×œ×™×•×ª
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: bot_handlers.py:309-328</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from telegram import InlineKeyboardButton, InlineKeyboardMarkup

# ×™×¦×™×¨×ª ×ª×¤×¨×™×˜ ×¢× ×›×¤×ª×•×¨×™× ××¨×•×‘×™×
buttons = [
    [
        InlineKeyboardButton("ğŸ—‘ï¸ ××—×™×§×”", callback_data=f"delete_{file_id}"),
        InlineKeyboardButton("âœï¸ ×¢×¨×™×›×”", callback_data=f"edit_{file_id}")
    ],
    [
        InlineKeyboardButton("ğŸ“ ×¢×¨×•×š ×”×¢×¨×”", callback_data=f"edit_note_{file_id}"),
        InlineKeyboardButton("ğŸ’¾ ×”×•×¨×“×”", callback_data=f"download_{file_id}")
    ],
    [
        InlineKeyboardButton("ğŸŒ ×©×™×ª×•×£", callback_data=f"share_{file_id}")
    ],
    [
        InlineKeyboardButton(fav_text, callback_data=fav_cb)
    ]
]
reply_markup = InlineKeyboardMarkup(buttons)
await update.message.reply_text(
    response_text,
    parse_mode='HTML',
    reply_markup=reply_markup
)</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="telegram callback confirmation python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×ª×™×‘×ª ××™×©×•×¨ ×¢× ×›×¤×ª×•×¨×™× (Yes/No Dialog)</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×“×™××œ×•×’ ××™×©×•×¨ ×¤×©×•×˜ ×œ×¤× ×™ ×‘×™×¦×•×¢ ×¤×¢×•×œ×” ×§×¨×™×˜×™×ª
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: bot_handlers.py:530-544</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from telegram import InlineKeyboardButton, InlineKeyboardMarkup
from telegram.constants import ParseMode

keyboard = [
    [
        InlineKeyboardButton("âœ… ×›×Ÿ, ××—×§", callback_data=f"confirm_delete_{file_name}"),
        InlineKeyboardButton("âŒ ×‘×™×˜×•×œ", callback_data="cancel_delete")
    ]
]
reply_markup = InlineKeyboardMarkup(keyboard)

await update.message.reply_text(
    f"ğŸ—‘ï¸ **××™×©×•×¨ ××—×™×§×”**\\n\\n"
    f"×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª `{file_name}`?",
    parse_mode=ParseMode.MARKDOWN,
    reply_markup=reply_markup
)</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="telegram callback router python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Callback Query Handler - × ×™×ª×•×‘ ×œ×¤×™ ×“×¤×•×¡</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×˜×™×¤×•×œ ××¨×•×›×– ×‘×›×œ ×œ×—×™×¦×•×ª ×”×›×¤×ª×•×¨×™×, ×¢× × ×™×ª×•×‘ ×œ×¤×™ prefix
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: bot_handlers.py:2703-2770</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>async def handle_callback_query(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """×˜×™×¤×•×œ ×‘×œ×—×™×¦×•×ª ×¢×œ ×›×¤×ª×•×¨×™×"""
    query = update.callback_query
    await query.answer()  # ×—×©×•×‘! ×××©×¨ ×§×‘×œ×ª ×”×œ×—×™×¦×”

    data = query.data
    user_id = query.from_user.id

    try:
        if data.startswith("confirm_delete_"):
            file_name = data.replace("confirm_delete_", "")
            if db.delete_file(user_id, file_name):
                await query.edit_message_text(
                    f"âœ… ×”×§×•×‘×¥ `{file_name}` × ××—×§ ×‘×”×¦×œ×—×”!",
                    parse_mode=ParseMode.MARKDOWN
                )

        elif data == "cancel_delete":
            await query.edit_message_text("âŒ ××—×™×§×” ×‘×•×˜×œ×”.")

        elif data.startswith("share_gist_"):
            file_name = data.replace("share_gist_", "")
            await self._share_to_gist(query, user_id, file_name)

        # ... more handlers

    except Exception as e:
        logger.error(f"Error handling callback: {e}")
        await query.edit_message_text("âš ï¸ ××™×¨×¢×” ×©×’×™××”")</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="telegram pagination python buttons">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Pagination Helper - ×›×¤×ª×•×¨×™ ×”×§×•×“×/×”×‘×</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×¤×•× ×§×¦×™×” ×©×™××•×©×™×ª ×œ×‘× ×™×™×ª ×›×¤×ª×•×¨×™ × ×™×•×•×˜ ×‘×¢××•×“×™×
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: handlers/pagination.py:6-29</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from telegram import InlineKeyboardButton
from typing import Optional, List

def build_pagination_row(
    page: int,
    total_items: int,
    page_size: int,
    callback_prefix: str,
) -> Optional[List[InlineKeyboardButton]]:
    """×‘×•× ×” ×©×•×¨×ª ×›×¤×ª×•×¨×™ pagination ××• None ×× ××™×Ÿ ×¦×•×¨×š."""
    if page_size <= 0:
        return None

    total_pages = (total_items + page_size - 1) // page_size if total_items > 0 else 1
    if total_pages <= 1:
        return None

    row: List[InlineKeyboardButton] = []

    if page > 1:
        row.append(
            InlineKeyboardButton("â¬…ï¸ ×”×§×•×“×", callback_data=f"{callback_prefix}{page-1}")
        )

    if page < total_pages:
        row.append(
            InlineKeyboardButton("â¡ï¸ ×”×‘×", callback_data=f"{callback_prefix}{page+1}")
        )

    return row or None</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="telegram callback router javascript">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Callback Query Router (JavaScript)</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> × ×™×ª×•×‘ ××•×˜×•××˜×™ ×©×œ callback queries ×œ×¤×™ prefix, ×—×•×¡×š if-else ××¨×•×›×™× ×•×××¨×’×Ÿ ××ª ×”×§×•×“
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>async handleCallbackQuery(query) {
  const chatId = query.message.chat.id;
  const userId = query.from.id;
  const data = query.data;
  const messageId = query.message.message_id;

  // Answer callback to remove loading state
  await this.bot.answerCallbackQuery(query.id);

  // Route based on callback data prefix
  if (data.startsWith('pace_')) {
    await this.handlePaceSelection(chatId, userId, data, messageId);
  } else if (data.startsWith('answer_')) {
    await this.handleQuizAnswer(chatId, userId, data, messageId);
  } else if (data.startsWith('theme_')) {
    await this.handleThemeSelection(chatId, userId, data, messageId);
  } else if (data.startsWith('cheat_')) {
    await this.handleCheatsheetTopic(chatId, userId, data, messageId);
  } else if (data.startsWith('template_')) {
    await this.handleTemplateSelection(chatId, userId, data);
  }
}</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="telegram inline-keyboard javascript">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Inline Keyboard Builder (JavaScript)</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×‘× ×™×™×ª inline keyboards ×“×™× ××™×™× ×‘×§×œ×•×ª
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>buildInlineKeyboard(buttons) {
  // buttons: [[{text, callback_data}], [{text, callback_data}]]
  return {
    inline_keyboard: buttons
  };
}

// ×“×•×’××”: ×ª×¤×¨×™×˜ ×ª×‘× ×™×•×ª
const keyboard = [
  [{ text: 'ğŸ“‹ PRD - ××¡××š ×“×¨×™×©×•×ª', callback_data: 'template_prd' }],
  [{ text: 'ğŸ“– README - ×ª×™×¢×•×“ ×¤×¨×•×™×§×˜', callback_data: 'template_readme' }],
  [{ text: 'ğŸ” Post Mortem - × ×™×ª×•×— ×ª×§×œ×”', callback_data: 'template_postmortem' }]
];

await this.bot.sendMessage(chatId, '×‘×—×¨ ×ª×‘× ×™×ª:', {
  reply_markup: { inline_keyboard: keyboard }
});</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="telegram safe-send markdown python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">××¢× ×” ×‘×˜×•×— ×œ-CallbackQuery</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ××‘×¦×¢ query.answer ×¢× ×”×—×¨×’×” ×©×œ ×©×’×™××•×ª ×™×“×•×¢×•×ª
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>@staticmethod
async def safe_answer(query, text: Optional[str] = None, show_alert: bool = False, cache_time: Optional[int] = None) -> None:
    """××¢× ×” ×‘×˜×•×— ×œ-CallbackQuery: ××ª×¢×œ× ××©×’×™××•×ª 'Query is too old'."""
    try:
        kwargs: Dict[str, Any] = {}
        if text is not None:
            kwargs["text"] = text
        if show_alert:
            kwargs["show_alert"] = True
        if cache_time is not None:
            kwargs["cache_time"] = int(cache_time)
        await query.answer(**kwargs)
    except Exception as e:
        msg = str(e).lower()
        if "query is too old" in msg or "query_id_invalid" in msg:
            return
        raise</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: Database -->
                <div class="category" data-category="database">
                    <div class="category-header">
                        <h2>ğŸ—„ï¸ ×¢×‘×•×“×” ×¢× ××¡×“ × ×ª×•× ×™×</h2>
                        <p>MongoDB, SQLAlchemy, Transactions, Queries</p>
                    </div>

                    <div class="snippet" data-tags="mongodb versioning python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×©××™×¨×ª ××¡××š ×¢× Versioning</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge mongodb">MongoDB</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×©××™×¨×” ×¢× × ×™×”×•×œ ×’×¨×¡××•×ª ××•×˜×•××˜×™ + ×‘×™×˜×•×œ cache
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: database/repository.py:141-165</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from datetime import datetime, timezone
from dataclasses import asdict

def save_code_snippet(self, snippet: CodeSnippet) -> bool:
    try:
        # × ×¨××•×œ ×§×•×“ ×œ×¤× ×™ ×©××™×¨×”
        if config.NORMALIZE_CODE_ON_SAVE:
            snippet.code = normalize_code(snippet.code)

        # ×‘×“×™×§×ª ×’×¨×¡×” ×§×™×™××ª
        existing = self.get_latest_version(snippet.user_id, snippet.file_name)
        if existing:
            snippet.version = existing['version'] + 1

        snippet.updated_at = datetime.now(timezone.utc)

        # ×©××™×¨×” ×‘××¡×“ ×”× ×ª×•× ×™×
        result = self.manager.collection.insert_one(asdict(snippet))

        if result.inserted_id:
            # ×‘×™×˜×•×œ cache ×œ××©×ª××©
            cache.invalidate_user_cache(snippet.user_id)
            return True

        return False

    except Exception as e:
        logger.error(f"Error saving snippet: {e}")
        return False</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="mongodb cache query python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×©×œ×™×¤×ª ××¡××š ××—×“ ×¢× ××˜××•×Ÿ (Cached Query)</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge mongodb">MongoDB</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×©×œ×™×¤×” ××”×™×¨×” ×¢× caching ××•×˜×•××˜×™ ×œ××©×š 3 ×“×§×•×ª
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: database/repository.py:643-671</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from typing import Optional, Dict

@cached(expire_seconds=180, key_prefix="latest_version")
def get_latest_version(self, user_id: int, file_name: str) -> Optional[Dict]:
    try:
        # ×©×œ×™×¤×” ××”-DB ×¢× ×¡×™× ×•×Ÿ ×•×¡×™×“×•×¨
        return self.manager.collection.find_one(
            {
                "user_id": user_id,
                "file_name": file_name,
                "$or": [
                    {"is_active": True},
                    {"is_active": {"$exists": False}}
                ]
            },
            sort=[("version", -1)],
        )

    except Exception as e:
        logger.error(f"Error fetching latest version: {e}")
        return None</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="mongodb upsert python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Update ×¢× Upsert ×•×˜×™×¤×•×œ ×‘×©×“×•×ª ××•×ª× ×™×</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge mongodb">MongoDB</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×¢×“×›×•×Ÿ ××• ×™×¦×™×¨×” (upsert) ×¢× ×”×’×“×¨×ª ×©×“×•×ª ×©×•× ×™×
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: database/repository.py:1513-1529</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from datetime import datetime, timezone

def save_github_token(self, user_id: int, token: str) -> bool:
    try:
        # ×”×¦×¤× ×ª ×”×˜×•×§×Ÿ
        from secret_manager import encrypt_secret
        enc = encrypt_secret(token)
        stored = enc if enc else token

        users_collection = self.manager.db.users

        result = users_collection.update_one(
            {"user_id": user_id},
            {
                "$set": {
                    "github_token": stored,
                    "updated_at": datetime.now(timezone.utc)
                },
                "$setOnInsert": {
                    "created_at": datetime.now(timezone.utc)
                }
            },
            upsert=True,  # ×™×¦×™×¨×” ×× ×œ× ×§×™×™×
        )

        return bool(result.acknowledged)

    except Exception as e:
        logger.error(f"Error saving token: {e}")
        return False</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="mongodb aggregation pipeline python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Aggregation Pipeline - ×©××™×œ×ª× ××•×¨×›×‘×ª</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge mongodb">MongoDB</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×©××™×œ×ª×•×ª ××ª×§×“××•×ª ×¢× grouping, sorting ×•-projection
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: database/repository.py:394-404</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>def get_latest_files_aggregated(self, user_id: int, limit: int = 50):
    """××—×–×™×¨ ××ª ×”×’×¨×¡×” ×”××—×¨×•× ×” ×©×œ ×›×œ ×§×•×‘×¥"""

    pipeline = [
        {"$match": {"user_id": user_id, "is_active": True}},
        {"$sort": {"file_name": 1, "version": -1}},
        {"$group": {
            "_id": "$file_name",
            "latest": {"$first": "$$ROOT"}
        }},
        {"$replaceRoot": {"newRoot": "$latest"}},
        {"$sort": {"updated_at": -1}},
        {"$limit": max(1, int(limit or 50))},
        {"$project": {
            "_id": 1,
            "file_name": 1,
            "programming_language": 1,
            "updated_at": 1
        }},
    ]

    rows = list(self.manager.collection.aggregate(pipeline, allowDiskUse=True))
    return rows</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="mongodb soft-delete ttl python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Soft Delete ×¢× TTL (Recycle Bin)</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge mongodb">MongoDB</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ××—×™×§×” ×¨×›×” ×¢× ××¤×©×¨×•×ª ×©×—×–×•×¨, ×•××—×™×§×” ×¡×•×¤×™×ª ××•×˜×•××˜×™×ª ×œ××—×¨ 7 ×™××™×
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: database/repository.py:954-986</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from datetime import datetime, timezone, timedelta

def delete_file(self, user_id: int, file_name: str) -> bool:
    """××—×™×§×” ×¨×›×” - ××¡××Ÿ ×›×œ× ×¤×¢×™×œ ×‘××§×•× ×œ××—×•×§"""
    try:
        now = datetime.now(timezone.utc)
        ttl_days = int(getattr(config, 'RECYCLE_TTL_DAYS', 7) or 7)
        expires = now + timedelta(days=max(1, ttl_days))

        result = self.manager.collection.update_many(
            {
                "user_id": user_id,
                "file_name": file_name,
                "$or": [
                    {"is_active": True},
                    {"is_active": {"$exists": False}}
                ]
            },
            {
                "$set": {
                    "is_active": False,
                    "updated_at": now,
                    "deleted_at": now,
                    "deleted_expires_at": expires,  # TTL field
                }
            },
        )

        if result.modified_count > 0:
            cache.invalidate_user_cache(user_id)
            return True

        return False

    except Exception as e:
        logger.error(f"Error deleting file: {e}")
        return False</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="sqlalchemy async session python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Async Database Session Context Manager</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge database">SQLAlchemy</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> × ×™×”×•×œ session ××•×˜×•××˜×™ ×¢× ×¡×’×™×¨×” ×‘×˜×•×—×”
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from sqlalchemy.ext.asyncio import AsyncSession, async_sessionmaker, create_async_engine

# Create async engine
engine = create_async_engine(
    settings.DATABASE_URL,
    pool_size=settings.DATABASE_POOL_SIZE,
    max_overflow=settings.DATABASE_MAX_OVERFLOW,
    pool_timeout=settings.DATABASE_POOL_TIMEOUT,
    echo=settings.DATABASE_ECHO,
    pool_pre_ping=True,
    pool_recycle=3600,
)

# Create session factory
async_session_maker = async_sessionmaker(
    engine,
    class_=AsyncSession,
    expire_on_commit=False,
    autoflush=False,
)

# Usage
async def some_database_operation():
    async with async_session_maker() as session:
        result = await session.execute(select(User).where(User.id == user_id))
        user = result.scalar_one_or_none()
        
        user.last_login_at = datetime.now(timezone.utc)
        
        await session.commit()
        await session.refresh(user)
        
        return user</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="sqlite transaction javascript">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Database Transaction Pattern</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                                <span class="badge database">SQLite</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×‘×™×¦×•×¢ ××¡×¤×¨ ×¤×¢×•×œ×•×ª DB ×›×˜×¨× ×–×§×¦×™×” ××˜×•××™×ª
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>resetUserProgress(userId) {
  const trx = this.db.transaction((uid) => {
    // Reset core progress fields
    const resetStmt = this.db.prepare(`
      UPDATE user_progress
      SET current_lesson = 0,
          total_score = 0,
          level = 'Beginner',
          lessons_completed = 0,
          correct_answers = 0,
          wrong_answers = 0
      WHERE user_id = ?
    `);
    resetStmt.run(uid);

    // Clear lesson history
    const delHistory = this.db.prepare('DELETE FROM lesson_history WHERE user_id = ?');
    delHistory.run(uid);

    // Reset user mode
    const resetMode = this.db.prepare(`
      INSERT OR REPLACE INTO user_modes (user_id, current_mode)
      VALUES (?, 'normal')
    `);
    resetMode.run(uid);
  });

  trx(userId);
}</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: Authentication & Security -->
                <div class="category" data-category="auth">
                    <div class="category-header">
                        <h2>ğŸ” ××™××•×ª ×•××‘×˜×—×”</h2>
                        <p>JWT, Tokens, Login, Permissions</p>
                    </div>

                    <div class="snippet" data-tags="webapp login token python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×™×¦×™×¨×ª ×˜×•×§×Ÿ ×”×ª×—×‘×¨×•×ª ×œ-WebApp</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×™×¦×™×¨×ª ×˜×•×§×Ÿ ×××•×‘×˜×— ×œ×›× ×™×¡×” ×œ-WebApp ××”×‘×•×˜
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: conversation_handlers.py:171-202</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>import hashlib
import time
from datetime import datetime, timezone, timedelta
from typing import Optional, Dict

def _build_webapp_login_payload(
    db_manager,
    user_id: int,
    username: Optional[str]
) -> Optional[Dict[str, str]]:
    """×™×•×¦×¨ ×˜×•×§×Ÿ ×”×ª×—×‘×¨×•×ª ×××•×‘×˜×— ×œ-WebApp"""

    base_url = os.getenv("WEBAPP_URL") or config.WEBAPP_URL
    secret = os.getenv("WEBAPP_LOGIN_SECRET") or config.SECRET_KEY

    try:
        token_data = f"{user_id}:{int(time.time())}:{secret}"
        auth_token = hashlib.sha256(token_data.encode("utf-8")).hexdigest()[:32]
    except Exception:
        logger.exception("×™×¦×™×¨×ª ×˜×•×§×Ÿ webapp × ×›×©×œ×”")
        return None

    # ×©××™×¨×ª ×”×˜×•×§×Ÿ ×‘-DB
    now_utc = datetime.now(timezone.utc)
    token_doc = {
        "token": auth_token,
        "user_id": user_id,
        "username": username,
        "created_at": now_utc,
        "expires_at": now_utc + timedelta(minutes=5),
    }
    db_manager.db.webapp_tokens.insert_one(token_doc)

    # ×™×¦×™×¨×ª URL ×”×ª×—×‘×¨×•×ª
    login_url = f"{base_url}/auth/token?token={auth_token}&user_id={user_id}"

    return {
        "auth_token": auth_token,
        "login_url": login_url,
        "webapp_url": base_url,
    }</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="jwt token creation python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">JWT Token Creation</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×™×¦×™×¨×ª JWT tokens ×××•×‘×˜×—×™×
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>import jwt
from datetime import datetime, timezone, timedelta

def create_access_token(
    subject: Union[str, int],
    expires_delta: Optional[timedelta] = None,
    additional_claims: Optional[Dict[str, Any]] = None
) -> str:
    """Create JWT access token"""
    if expires_delta:
        expire = datetime.now(timezone.utc) + expires_delta
    else:
        expire = datetime.now(timezone.utc) + timedelta(days=7)
    
    to_encode = {
        "exp": expire,
        "sub": str(subject),
        "iat": datetime.now(timezone.utc),
        "type": "access",
    }
    
    if additional_claims:
        to_encode.update(additional_claims)
    
    encoded_jwt = jwt.encode(
        to_encode,
        settings.SECRET_KEY,
        algorithm="HS256"
    )
    
    return encoded_jwt</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="jwt validation dependency python fastapi">
                        <div class="snippet-header">
                            <h3 class="snippet-title">JWT Token Validation Dependency</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ××™××•×ª ××•×˜×•××˜×™ ×©×œ ××©×ª××© ×-JWT
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials

security = HTTPBearer()

async def get_current_user(
    session: AsyncSession = Depends(get_db_session),
    credentials: Optional[HTTPAuthorizationCredentials] = Depends(security)
) -> Optional[User]:
    """Get current authenticated user from JWT token"""
    if not credentials:
        return None
    
    try:
        payload = jwt.decode(
            credentials.credentials,
            settings.SECRET_KEY,
            algorithms=["HS256"]
        )
        
        user_id = payload.get("sub")
        if not user_id:
            return None
        
        result = await session.execute(
            select(User).where(User.id == uuid.UUID(user_id))
        )
        user = result.scalar_one_or_none()
        
        if not user or not user.is_active:
            return None
        
        return user
    
    except Exception as e:
        logger.debug("Authentication failed", error=str(e))
        return None</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: Utilities -->
                <div class="category" data-category="utilities">
                    <div class="category-header">
                        <h2>ğŸ› ï¸ ×¤×•× ×§×¦×™×•×ª ×¢×–×¨</h2>
                        <p>Time, Text, Validation, File Utils</p>
                    </div>

                    <div class="snippet" data-tags="time format hebrew python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×–××Ÿ ×™×—×¡×™ ×‘×¢×‘×¨×™×ª</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×”×¦×’×ª ×–××Ÿ ×™×—×¡×™ ×‘×©×¤×” ×˜×‘×¢×™×ª (×œ×¤× ×™ 5 ×“×§×•×ª, ××ª××•×œ)
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>@staticmethod
def format_relative_time(dt: datetime) -> str:
    """×¤×•×¨××˜ ×–××Ÿ ×™×—×¡×™ (×œ×¤× ×™ 5 ×“×§×•×ª, ××ª××•×œ ×•×›×•')"""
    
    now = datetime.now(timezone.utc) if dt.tzinfo else datetime.now()
    diff = now - dt
    
    if diff.days > 365:
        years = diff.days // 365
        return f"×œ×¤× ×™ {years} ×©× {'×”' if years == 1 else '×™×'}"
    
    elif diff.days > 30:
        months = diff.days // 30
        return f"×œ×¤× ×™ {months} ×—×•×“{'×©' if months == 1 else '×©×™×'}"
    
    elif diff.days > 7:
        weeks = diff.days // 7
        return f"×œ×¤× ×™ {weeks} ×©×‘×•×¢{'×•×ª' if weeks > 1 else ''}"
    
    elif diff.days > 0:
        if diff.days == 1:
            return "××ª××•×œ"
        return f"×œ×¤× ×™ {diff.days} ×™××™×"
    
    elif diff.seconds > 3600:
        hours = diff.seconds // 3600
        return f"×œ×¤× ×™ {hours} ×©×¢{'×”' if hours == 1 else '×•×ª'}"
    
    elif diff.seconds > 60:
        minutes = diff.seconds // 60
        return f"×œ×¤× ×™ {minutes} ×“×§{'×”' if minutes == 1 else '×•×ª'}"
    
    else:
        return "×¢×›×©×™×•"</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="markdown escape telegram python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">××¡×§×™×™×¤ ×œ-Markdown ×‘×˜×œ×’×¨×</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ××ª××™× ×›×©×¦×¨×™×š ×œ×”×¦×™×’ ×˜×§×¡×˜ ×’×•×œ××™ ×‘×˜×œ×’×¨×
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>@staticmethod
def escape_markdown(text: str, version: int = 2) -> str:
    """×”×’× ×” ×¢×œ ×ª×•×•×™× ××™×•×—×“×™× ×‘-Markdown"""
    
    if version == 2:
        special_chars = set("_*[]()~`>#+-=|{}.!\\\\")
        return "".join(("\\\\" + ch) if ch in special_chars else ch for ch in text)
    else:
        special_chars = set("_*`[()\\\\")
        return "".join(("\\\\" + ch) if ch in special_chars else ch for ch in text)</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="text filename clean python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">× ×™×§×•×™ ×©××•×ª ×§×‘×¦×™×</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ××¡×™×¨ ×ª×•×•×™× ××¡×•×¨×™× ×•××§×¦×¨ ×©××•×ª ×œ×¤× ×™ ×©××™×¨×”
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>@staticmethod
def clean_filename(filename: str) -> str:
    """× ×™×§×•×™ ×©× ×§×•×‘×¥ ××ª×•×•×™× ×œ× ×—×•×§×™×™×"""
    
    # ×”×¡×¨×ª ×ª×•×•×™× ×œ× ×—×•×§×™×™×
    cleaned = re.sub(r'[<>:"/\\\\|?*]', '_', filename)
    
    # ×”×¡×¨×ª ×¨×•×•×—×™× ××™×•×ª×¨×™×
    cleaned = re.sub(r'\\s+', '_', cleaned)
    
    # ×”×¡×¨×ª × ×§×•×“×•×ª ××™×•×ª×¨×•×ª
    cleaned = re.sub(r'\\.+', '.', cleaned)
    
    # ×”×’×‘×œ×ª ××•×¨×š
    if len(cleaned) > 100:
        name, ext = os.path.splitext(cleaned)
        cleaned = name[:100-len(ext)] + ext
    
    return cleaned.strip('._')</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="telegram long-message split python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×¤×™×¦×•×œ ×”×•×“×¢×•×ª ××¨×•×›×•×ª</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×¤×™×¦×•×œ ×ª×©×•×‘×” ×’×“×•×œ×” ×œ××§×˜×¢×™× ×‘×’×‘×•×œ 4096 ×ª×•×•×™×
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>@staticmethod
def split_long_message(text: str, max_length: int = 4096) -> List[str]:
    """×—×œ×•×§×ª ×”×•×“×¢×” ××¨×•×›×” ×œ×—×œ×§×™×"""
    
    if len(text) <= max_length:
        return [text]
    
    parts = []
    current_part = ""
    
    for line in text.split('\\n'):
        if len(current_part) + len(line) + 1 <= max_length:
            current_part += line + '\\n'
        else:
            if current_part:
                parts.append(current_part.rstrip())
            current_part = line + '\\n'
    
    if current_part:
        parts.append(current_part.rstrip())
    
    return parts</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="cache ttl python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×§××© ×–×™×›×¨×•×Ÿ ×¢× TTL</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×©××™×¨×ª ×¢×¨×›×™× ×‘×–×™×›×¨×•×Ÿ ×œ×–××Ÿ ×§×¦×•×‘ ×¢× ×”×¡×¨×” ××•×˜×•××˜×™×ª
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>class CacheUtils:
    """×›×œ×™× ×œ×§××© ×–×× ×™"""
    
    _cache: Dict[str, Any] = {}
    _cache_times: Dict[str, float] = {}
    
    @classmethod
    def set(cls, key: str, value: Any, ttl: int = 300):
        """×©××™×¨×” ×‘×§××© ×¢× TTL (×©× ×™×•×ª)"""
        cls._cache[key] = value
        cls._cache_times[key] = time.time() + ttl
    
    @classmethod
    def get(cls, key: str, default: Any = None) -> Any:
        """×§×‘×œ×” ××”×§××©"""
        if key not in cls._cache:
            return default
        
        # ×‘×“×™×§×ª ×ª×¤×•×’×”
        if time.time() > cls._cache_times.get(key, 0):
            cls.delete(key)
            return default
        
        return cls._cache[key]

    @classmethod
    def delete(cls, key: str):
        """××—×™×§×” ××”×§××©"""
        cls._cache.pop(key, None)
        cls._cache_times.pop(key, None)</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: Logging & Monitoring -->
                <div class="category" data-category="logging">
                    <div class="category-header">
                        <h2>ğŸ“Š Logging ×•-Monitoring</h2>
                        <p>Structured Logs, Metrics, Context Binding</p>
                    </div>

                    <div class="snippet" data-tags="structlog logging python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Emit Event ×¢× Request ID</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×œ×•×’×™× ××•×‘× ×™× ×¢× ××¢×§×‘ ××—×¨ request ×™×™×—×•×“×™
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: observability.py:492-589</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>import structlog
from typing import Any

def emit_event(event: str, severity: str = "info", **fields: Any) -> None:
    """×©×•×œ×— ××™×¨×•×¢ ×œ×•×’ ××•×‘× ×”"""

    logger = structlog.get_logger()
    fields.setdefault("event", event)

    # ×”×•×¡×¤×ª request_id ××”×§×•× ×˜×§×¡×˜
    if severity in {"error", "critical"}:
        ctx = get_observability_context()
        request_id = str(fields.get("request_id") or ctx.get("request_id") or "").strip()
        if request_id and "request_id" not in fields:
            fields["request_id"] = request_id

    # ×©×œ×™×—×ª ×œ×•×’
    log_method = getattr(logger, severity, logger.info)
    log_method(event, **fields)

# ×©×™××•×©:
# emit_event("file_saved", severity="info", user_id=123, file_name="main.py")
# emit_event("db_error", severity="error", error=str(e), request_id=req_id)</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="structlog context binding python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Binding User Context</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×§×™×©×•×¨ user_id ×•-chat_id ×œ×›×œ ×”×œ×•×’×™×
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: observability.py:171-185</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>import structlog
from typing import Any, Optional, Dict

def bind_user_context(
    *,
    user_id: Any | None = None,
    chat_id: Any | None = None
) -> None:
    """×§×•×©×¨ ×”×§×©×¨ ××©×ª××© ×œ×›×œ ×”×œ×•×’×™×"""

    to_bind: Dict[str, str] = {}

    # Hash ×©×œ user_id (××‘×˜×—×ª ×¤×¨×˜×™×•×ª)
    user_hash = _hash_identifier(user_id)
    if user_hash:
        to_bind["user_id"] = user_hash

    # Hash ×©×œ chat_id
    chat_hash = _hash_identifier(chat_id)
    if chat_hash:
        to_bind["chat_id"] = chat_hash

    # ×§×™×©×•×¨ ×œ×§×•× ×˜×§×¡×˜
    if to_bind:
        try:
            structlog.contextvars.bind_contextvars(**to_bind)
        except Exception:
            pass</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="prometheus metrics python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Prometheus Metrics</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ××“×“×™ ×‘×™×¦×•×¢×™× ×œ× ×™×˜×•×¨ production
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from prometheus_client import Counter, Histogram, generate_latest

# Define metrics
REQUEST_COUNT = Counter(
    'http_requests_total',
    'Total HTTP requests',
    ['method', 'endpoint', 'status_code']
)

REQUEST_DURATION = Histogram(
    'http_request_duration_seconds',
    'HTTP request duration in seconds',
    ['method', 'endpoint']
)

# Update metrics
REQUEST_COUNT.labels(
    method=request.method,
    endpoint=request.url.path,
    status_code=response.status_code
).inc()

REQUEST_DURATION.labels(
    method=request.method,
    endpoint=request.url.path
).observe(duration)</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: Background Jobs -->
                <div class="category" data-category="jobs">
                    <div class="category-header">
                        <h2>âš™ï¸ Background Jobs</h2>
                        <p>RQ, Async Processing, Scheduling</p>
                    </div>

                    <div class="snippet" data-tags="rq job retry python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">RQ Job Definition ×¢× Retry</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> background job ×¢× RQ ×›×•×œ×œ retry ××•×˜×•××˜×™
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from rq import Retry
from rq.decorators import job
from app.core.cache import redis_queue_sync

@job("default", timeout="10m", retry=Retry(max=3, interval=60), connection=redis_queue_sync)
def process_new_report(report_id: str):
    """Process a newly submitted report"""
    logger.info("Processing report", report_id=report_id)
    
    try:
        return asyncio.run(_process_new_report_async(report_id))
    except Exception as e:
        logger.error("Failed to process report", report_id=report_id, error=str(e))
        raise  # Re-raise for RQ retry mechanism</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="rq enqueue pattern python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Enqueue or Run Inline Pattern</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×ª××™×›×” ×‘-workers ×•×’× ×‘××¦×‘ ×œ×œ× workers
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>def enqueue_or_run(func, *args, **kwargs):
    """Enqueue an RQ job when workers enabled, otherwise run inline"""
    if settings.ENABLE_WORKERS:
        # Production: Queue to RQ worker
        return func.delay(*args, **kwargs)
    else:
        # Development: Run inline
        if asyncio.iscoroutinefunction(func):
            return asyncio.create_task(func(*args, **kwargs))
        else:
            return func(*args, **kwargs)</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="retry backoff python async">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Retry Logic ×¢× Exponential Backoff</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> × ×¡×™×•× ×•×ª ×—×•×–×¨×™× ×—×›××™× ×œ×©×™×¨×•×ª×™× ×—×™×¦×•× ×™×™×
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>import asyncio

async def retry_with_backoff(
    func: Callable[..., T],
    max_retries: int = 3,
    base_delay: float = 1.0,
    max_delay: float = 30.0,
    exponential_base: float = 2.0,
    *args,
    **kwargs
) -> T:
    """Retry function with exponential backoff"""
    last_exception = None
    
    for attempt in range(max_retries):
        try:
            return await func(*args, **kwargs)
        
        except Exception as e:
            last_exception = e
            
            if attempt == max_retries - 1:
                break
            
            delay = min(
                base_delay * (exponential_base ** attempt),
                max_delay
            )
            
            logger.warning(
                "Retry attempt failed",
                attempt=attempt + 1,
                delay=delay
            )
            
            await asyncio.sleep(delay)
    
    raise last_exception</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: Error Handling -->
                <div class="category" data-category="errors">
                    <div class="category-header">
                        <h2>ğŸš¨ ×˜×™×¤×•×œ ×‘×©×’×™××•×ª</h2>
                        <p>Exceptions, Validation, User Feedback</p>
                    </div>

                    <div class="snippet" data-tags="validation error python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Validation ×¢× Error Messages</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×•×œ×™×“×¦×™×” ×¢× ×”×—×–×¨×ª tuple ×©×œ (success, data, error_message)
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: services/code_service.py:113-168</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from typing import Tuple

def validate_code_input(
    code: str,
    file_name: str,
    user_id: int
) -> Tuple[bool, str, str]:
    """
    ×‘×•×“×§ ×•×× ×§×” ×§×œ×˜ ×§×•×“.
    Returns: (is_valid, cleaned_code, error_message)
    """

    if not code or not code.strip():
        return False, "", "×”×§×•×“ ×¨×™×§"

    if len(code) > MAX_CODE_LENGTH:
        return False, "", f"×”×§×•×“ ××¨×•×š ××“×™ (××§×¡×™××•× {MAX_CODE_LENGTH} ×ª×•×•×™×)"

    # × ×™×§×•×™ ×§×•×“
    try:
        cleaned = normalize_code(code)
    except Exception as e:
        return False, "", f"×©×’×™××” ×‘× ×™×§×•×™ ×”×§×•×“: {str(e)}"

    return True, cleaned, ""</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="error user-feedback telegram javascript">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Error Handling with User Feedback</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ×¢× ×”×•×“×¢×•×ª ×™×“×™×“×•×ª×™×•×ª
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>async handleSandboxInput(chatId, userId, markdownText) {
  try {
    const processingMsg = await this.bot.sendMessage(chatId, 'â³ ××¢×‘×“ ××ª ×”×§×•×“ ×©×œ×š...');
    const imagePath = await this.renderer.renderMarkdown(markdownText, userId, theme);
    await this.bot.deleteMessage(chatId, processingMsg.message_id);
    await this.bot.sendPhoto(chatId, imagePath, {
      caption: 'âœ… ×”× ×” ×”×ª×•×¦××”!'
    });
  } catch (error) {
    console.error('Error rendering markdown:', error);
    await this.bot.sendMessage(chatId,
      'âŒ ××•×¤×¡! ××©×”×• ×”×©×ª×‘×© ×‘×¢×™×‘×•×“ ×”×§×•×“.\\n\\n' +
      '× ×¡×” ×©×•×‘ ××• ×©×œ×— /exit ×œ×¦××ª.'
    );
  }
}</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="graceful-shutdown javascript">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Graceful Shutdown</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×›×™×‘×•×™ ××¡×•×“×¨ ×©×œ ×”×‘×•×˜, ××•× ×¢ data loss
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>const gracefulShutdown = () => {
  console.log('\\nğŸ›‘ Shutting down gracefully...');
  
  if (bot) {
    bot.stopPolling();
  }
  db.close();
  
  process.exit(0);
};

process.on('SIGTERM', gracefulShutdown);
process.on('SIGINT', gracefulShutdown);

process.on('uncaughtException', (error) => {
  console.error('âŒ Uncaught Exception:', error);
});

process.on('unhandledRejection', (reason, promise) => {
  console.error('âŒ Unhandled Rejection:', reason);
});</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: Advanced Patterns -->
                <div class="category" data-category="advanced">
                    <div class="category-header">
                        <h2>ğŸ¯ ×ª×‘× ×™×•×ª ××ª×§×“××•×ª</h2>
                        <p>State Management, Middleware, Complex Flows</p>
                    </div>

                    <div class="snippet" data-tags="state-machine user-modes javascript">
                        <div class="snippet-header">
                            <h3 class="snippet-title">User Mode Management (State Machine)</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                                <span class="badge database">SQLite</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> × ×™×”×•×œ ××¦×‘×™ ××©×ª××© ×¢× × ×ª×•× ×™× JSON
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>getUserMode(userId) {
  const stmt = this.db.prepare('SELECT * FROM user_modes WHERE user_id = ?');
  let mode = stmt.get(userId);
  
  if (!mode) {
    const insertStmt = this.db.prepare(`
      INSERT INTO user_modes (user_id, current_mode)
      VALUES (?, 'normal')
    `);
    insertStmt.run(userId);
    mode = { user_id: userId, current_mode: 'normal', mode_data: null };
  }
  
  return mode;
}

setUserMode(userId, mode, modeData = null) {
  const stmt = this.db.prepare(`
    INSERT OR REPLACE INTO user_modes (user_id, current_mode, mode_data)
    VALUES (?, ?, ?)
  `);
  stmt.run(userId, mode, modeData ? JSON.stringify(modeData) : null);
}

// ×©×™××•×©:
const mode = this.db.getUserMode(userId);
if (mode.current_mode === 'sandbox') {
  await this.handleSandboxInput(chatId, userId, text);
} else if (mode.current_mode === 'training') {
  const modeData = JSON.parse(mode.mode_data);
  await this.handleTrainingAnswer(chatId, userId, text, modeData);
}</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="maintenance middleware javascript telegram">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Maintenance Mode Middleware</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×”×›× ×¡×ª ×”×‘×•×˜ ×œ××¦×‘ ×ª×—×–×•×§×” ×¢× ×’×™×©×” ×œ××“××™× ×™×
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>const isMaintenanceMode = () => {
  return process.env.MAINTENANCE_MODE === 'true';
};

const isAdmin = (userId) => {
  const admins = (process.env.ADMIN_USER_IDS || '')
    .split(',')
    .map(s => s.trim())
    .filter(Boolean);
  return admins.includes(String(userId));
};

const maintenanceMiddleware = async (msg, next) => {
  if (!isMaintenanceMode() || isAdmin(msg.from.id)) {
    return next();
  }

  await bot.sendMessage(msg.chat.id,
    'ğŸ”§ *×”×‘×•×˜ ×‘××¦×‘ ×ª×—×–×•×§×”*\\n\\n' +
    '×× ×—× ×• ×¢×•×©×™× ×©×“×¨×•×’ ××”×™×¨ ğŸš€\\n\\n' +
    '×”×›×œ ×™×—×–×•×¨ ×œ×¢×‘×•×“ ×ª×•×š ×›××” ×“×§×•×ª.\\n\\n' +
    '×ª×•×“×” ×¢×œ ×”×¡×‘×œ× ×•×ª! ğŸ˜Š',
    { parse_mode: 'Markdown' }
  );
  return false;
};</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="double-click guard python async">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×× ×™×¢×ª ×œ×—×™×¦×” ×›×¤×•×œ×” (CallbackQuery Guard)</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ××•× ×¢ ×”×¤×¢×œ×” ×›×¤×•×œ×” ×©×œ ××•×ª×• ×›×¤×ª×•×¨
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>class CallbackQueryGuard:
    """Guard ×œ×œ×—×™×¦×•×ª ×›×¤×•×œ×•×ª ×¢×œ ×›×¤×ª×•×¨×™ CallbackQuery"""

    DEFAULT_WINDOW_SECONDS: float = 1.2
    _user_locks: Dict[int, asyncio.Lock] = {}

    @staticmethod
    async def should_block_async(
        update: Update,
        context: ContextTypes.DEFAULT_TYPE,
        window_seconds: Optional[float] = None
    ) -> bool:
        """×‘×•×“×§ ×‘×¦×•×¨×” ××˜×•××™×ª ×× ×œ×—×¡×•× ×œ×—×™×¦×” ×›×¤×•×œ×”"""
        try:
            win = float(window_seconds or CallbackQueryGuard.DEFAULT_WINDOW_SECONDS)
            user_id = int(getattr(update.effective_user, 'id', 0) or 0)

            if user_id <= 0:
                return False

            # ×§×‘×œ/×¦×•×¨ × ×¢×™×œ×” ×œ××©×ª××©
            lock = CallbackQueryGuard._user_locks.get(user_id)
            if lock is None:
                lock = asyncio.Lock()
                CallbackQueryGuard._user_locks[user_id] = lock

            async with lock:
                now_ts = time.time()
                busy_until = float(context.user_data.get("_cb_guard_until", 0.0))
                
                if now_ts < busy_until:
                    return True
                
                context.user_data["_cb_guard_until"] = now_ts + win
                return False
        except Exception:
            return False</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="distributed-lock redis python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Distributed Lock ×¢× Redis</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> × ×¢×™×œ×” ××‘×•×–×¨×ª ×œ×× ×™×¢×ª race conditions
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>class DistributedLock:
    """Redis-based distributed lock"""
    
    def __init__(self, key: str, timeout: int = 30):
        self.key = f"lock:{key}"
        self.timeout = timeout
        self.identifier = f"{id(self)}:{time.time()}"
    
    async def acquire(self) -> bool:
        """Acquire the lock"""
        result = await redis_client.set(
            self.key,
            self.identifier,
            nx=True,
            ex=self.timeout
        )
        return bool(result)
    
    async def release(self) -> bool:
        """Release the lock (only if we own it)"""
        lua_script = """
        if redis.call('GET', KEYS[1]) == ARGV[1] then
            return redis.call('DEL', KEYS[1])
        else
            return 0
        end
        """
        result = await redis_client.eval(lua_script, 1, self.key, self.identifier)
        return bool(result)
    
    async def __aenter__(self):
        if await self.acquire():
            return self
        raise Exception(f"Could not acquire lock: {self.key}")
    
    async def __aexit__(self, exc_type, exc_val, exc_tb):
        await self.release()

# Usage
async with DistributedLock("process_report", timeout=60):
    await process_report_logic()</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: WebApp Integration -->
                <div class="category" data-category="webapp">
                    <div class="category-header">
                        <h2>ğŸŒ ××™× ×˜×’×¨×¦×™×” ×¢× WebApp</h2>
                        <p>×¤×ª×™×—×ª WebApp, Buttons, Frontend Integration</p>
                    </div>

                    <div class="snippet" data-tags="webapp button url python telegram">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×™×¦×™×¨×ª ×›×¤×ª×•×¨ WebApp ×¢× ×§×™×©×•×¨ ×œ×§×•×‘×¥</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×¤×ª×™×—×ª WebApp ×™×©×™×¨×•×ª ×œ×§×•×‘×¥ ×¡×¤×¦×™×¤×™ ××• ×ª×•×¦××•×ª ×—×™×¤×•×©
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: handlers/file_view.py:84-108</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from telegram import InlineKeyboardButton
from urllib.parse import quote_plus
from typing import Optional, List

def _get_webapp_button_row(
    file_id: Optional[str],
    file_name: Optional[str] = None
) -> Optional[List[InlineKeyboardButton]]:
    """×‘×•× ×” ×›×¤×ª×•×¨ WebApp ×¢× ×§×™×©×•×¨ ×œ×§×•×‘×¥"""

    base_url = os.getenv('WEBAPP_URL') or config.WEBAPP_URL
    if not base_url:
        return None

    # ×§×™×©×•×¨ ×™×©×™×¨ ×œ×§×•×‘×¥ ×œ×¤×™ ID
    if file_id:
        target_url = f"{base_url}/file/{file_id}"

    # ××• ×§×™×©×•×¨ ×œ×—×™×¤×•×© ×œ×¤×™ ×©×
    elif file_name:
        try:
            query = quote_plus(str(file_name))
        except Exception:
            query = str(file_name)
        target_url = f"{base_url}/files?q={query}#results"

    else:
        return None

    return [InlineKeyboardButton("ğŸŒ ×¦×¤×™×™×” ×‘WebApp", url=target_url)]</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="webapp init telegram javascript frontend">
                        <div class="snippet-header">
                            <h3 class="snippet-title">××ª×—×•×œ WebApp ×‘×¦×“ ×”×œ×§×•×— (Frontend)</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                                <span class="badge telegram">Telegram</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×–×™×”×•×™ ×©×”-WebApp × ×˜×¢×Ÿ ×‘×ª×•×š ×˜×œ×’×¨× ×•×”×ª×××ª ×”×ª×¦×•×’×”
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: webapp/templates/base.html:702-723</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>(function() {
    try {
        // ×–×™×”×•×™ Telegram WebApp SDK
        if (window.Telegram && window.Telegram.WebApp) {
            document.body.classList.add('telegram-mini-app');

            // ×”×¨×—×‘×ª viewport ×œ×©×™××•×© ××œ× ×‘××¡×š
            try {
                window.Telegram.WebApp.expand();
            } catch (e) {}

            // ××™×ª×•×ª ×©×”-WebApp ××•×›×Ÿ
            try {
                window.Telegram.WebApp.ready();
            } catch (e) {}

            // ×§×‘×œ×ª × ×ª×•× ×™ ××©×ª××© ××˜×œ×’×¨×
            const initData = window.Telegram.WebApp.initData;
            console.log('Telegram WebApp initialized:', initData);
        }
    } catch (e) {
        console.error('Error initializing Telegram WebApp:', e);
    }
})();</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: UI Components -->
                <div class="category" data-category="ui">
                    <div class="category-header">
                        <h2>ğŸ¨ ×¨×›×™×‘×™ UI ×‘-WebApp</h2>
                        <p>Modals, Notifications, Loading Indicators</p>
                    </div>

                    <div class="snippet" data-tags="modal dialog promise javascript frontend">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Modal Dialog ×¢× Promise</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×“×™××œ×•×’ ××•×“×œ×™ ×©××—×–×™×¨ ×ª×•×¦××” ×“×¨×š Promise
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: webapp/static/js/bulk-actions.js:296-428</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>async showTagDialog() {
    return new Promise((resolve) => {
        const dialog = document.createElement('div');
        dialog.className = 'modal-overlay';

        dialog.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-tags"></i> ×”×•×¡×£ ×ª×’×™×•×ª</h3>
                    <button class="modal-close" data-action="cancel">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="text" id="tagInput" class="tag-input"
                           placeholder="×œ××©×œ: python, utils, important" autofocus>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" data-action="confirm">
                        <i class="fas fa-check"></i> ××™×©×•×¨
                    </button>
                    <button class="btn btn-secondary" data-action="cancel">
                        <i class="fas fa-times"></i> ×‘×™×˜×•×œ
                    </button>
                </div>
            </div>
        `;

        document.body.appendChild(dialog);

        dialog.addEventListener('click', (e) => {
            const action = e.target.closest('[data-action]')?.dataset.action;

            if (action === 'confirm') {
                const input = dialog.querySelector('#tagInput');
                const tags = input.value.split(',').map(t => t.trim()).filter(Boolean);
                document.body.removeChild(dialog);
                resolve(tags);
            } else if (action === 'cancel') {
                document.body.removeChild(dialog);
                resolve(null);
            }
        });

        setTimeout(() => dialog.querySelector('#tagInput')?.focus(), 100);
    });
}

// Usage: const tags = await showTagDialog();</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="toast notification javascript frontend">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Toast Notification ×¢× Auto-Dismiss</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×”×¦×’×ª ×”×•×“×¢×•×ª ×–×× ×™×•×ª ×©× ×¢×œ××•×ª ××•×˜×•××˜×™×ª
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: webapp/static/js/bulk-actions.js:430-478</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>class NotificationManager {
    constructor() {
        this.notificationContainer = document.createElement('div');
        this.notificationContainer.className = 'notification-container';
        document.body.appendChild(this.notificationContainer);
    }

    showNotification(message, type = 'info', options = {}) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;

        let icon = 'info-circle';
        if (type === 'success') icon = options.icon || 'check-circle';
        else if (type === 'error') icon = 'exclamation-circle';

        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            </div>
            <button class="notification-close">
                <i class="fas fa-times"></i>
            </button>
        `;

        notification.querySelector('.notification-close').addEventListener('click', () => {
            notification.classList.add('fade-out');
            setTimeout(() => notification.remove(), 300);
        });

        this.notificationContainer.appendChild(notification);
        setTimeout(() => notification.classList.add('show'), 10);

        const duration = options.duration || 3000;
        setTimeout(() => {
            if (notification.parentNode) {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 300);
            }
        }, duration);
    }
}</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="loading overlay progress javascript">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Loading Overlay ×¢× Progress Bar</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ××¡×š ×˜×¢×™× ×” ×¢× ××¤×©×¨×•×ª ×œ×¢×“×›×•×Ÿ ×”×ª×§×“××•×ª
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: webapp/static/js/bulk-actions.js:12-29</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>class ProcessingOverlay {
    constructor() {
        const overlay = document.createElement('div');
        overlay.className = 'processing-overlay hidden';
        overlay.innerHTML = `
            <div class="processing-content">
                <div class="spinner"></div>
                <div class="processing-text">××¢×‘×“...</div>
                <div class="processing-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">0%</div>
                </div>
            </div>
        `;
        document.body.appendChild(overlay);
        this.overlay = overlay;
    }

    show(text = '××¢×‘×“...', showProgress = false) {
        this.overlay.querySelector('.processing-text').textContent = text;
        const progressEl = this.overlay.querySelector('.processing-progress');
        if (showProgress) {
            progressEl.classList.remove('hidden');
        } else {
            progressEl.classList.add('hidden');
        }
        this.overlay.classList.remove('hidden');
    }

    updateProgress(percent) {
        const progressFill = this.overlay.querySelector('.progress-fill');
        const progressText = this.overlay.querySelector('.progress-text');
        progressFill.style.width = `${percent}%`;
        progressText.textContent = `${Math.round(percent)}%`;
    }

    hide() {
        this.overlay.classList.add('hidden');
    }
}</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: File Management -->
                <div class="category" data-category="files">
                    <div class="category-header">
                        <h2>ğŸ“ × ×™×”×•×œ ×§×‘×¦×™×</h2>
                        <p>Upload, Validation, Storage, Cleanup</p>
                    </div>

                    <div class="snippet" data-tags="file save auto-detect language python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">×©××™×¨×ª ×§×•×‘×¥ ×¢× ×–×™×”×•×™ ×©×¤×” ××•×˜×•××˜×™</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×–×¨×™××” ××œ××” ×©×œ ×©××™×¨×ª ×§×•×‘×¥ - × ×¨××•×œ, ×–×™×”×•×™ ×©×¤×”, ×©××™×¨×”
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: handlers/save_flow.py:379-398</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from database import db, CodeSnippet
from services.code_service import detect_language, normalize_code

async def save_file_final(update, context, filename, user_id):
    """×©×•××¨ ×§×•×‘×¥ ×¢× metadata ××œ×"""

    code = context.user_data.get('code_to_save')

    # × ×¨××•×œ ×§×•×“
    try:
        code = normalize_code(code)
    except Exception:
        pass

    # ×–×™×”×•×™ ×©×¤×ª ×ª×›× ×•×ª
    detected_language = detect_language(code, filename)

    # ×”×¢×¨×” ××•×¤×¦×™×•× ×œ×™×ª
    note = (context.user_data.get('note_to_save') or '').strip()

    # ×™×¦×™×¨×ª snippet
    snippet = CodeSnippet(
        user_id=user_id,
        file_name=filename,
        code=code,
        programming_language=detected_language,
        description=note,
    )

    # ×©××™×¨×”
    success = db.save_code_snippet(snippet)

    if success:
        saved_doc = db.get_latest_version(user_id, filename) or {}
        file_id = str(saved_doc.get('_id') or '')
        
        context.user_data["last_save_success"] = {
            "file_name": filename,
            "language": detected_language,
            "file_id": file_id,
        }

        await update.message.reply_text(f"âœ… ×”×§×•×‘×¥ `{filename}` × ×©××¨ ×‘×”×¦×œ×—×”!")</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="file validation security python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">File Validation with Security Checks</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×‘×“×™×§×•×ª ××‘×˜×—×” ×œ×§×‘×¦×™× ×©×¢×•×œ×™× ×œ××¢×¨×›×ª
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>from PIL import Image
from io import BytesIO
import mimetypes

def validate_file(file_data: bytes, filename: str, content_type: str) -> None:
    """Validate uploaded file for security"""
    
    # Check file size
    max_size = settings.MAX_FILE_SIZE_MB * 1024 * 1024
    if len(file_data) > max_size:
        raise ValidationError(f"File size exceeds {settings.MAX_FILE_SIZE_MB}MB")
    
    # Check file type
    if content_type not in settings.ALLOWED_FILE_TYPES:
        raise ValidationError(f"File type {content_type} not allowed")
    
    # Security checks for images
    if content_type.startswith('image/'):
        try:
            image = Image.open(BytesIO(file_data))
            image.verify()
            
            if hasattr(image, 'size'):
                width, height = image.size
                if width > 10000 or height > 10000:
                    raise ValidationError("Image dimensions too large")
        except Exception as e:
            raise ValidationError(f"Invalid image: {str(e)}")
    
    # Check for malicious content
    if b'<script' in file_data.lower():
        raise ValidationError("File contains malicious content")</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="file cleanup javascript nodejs">
                        <div class="snippet-header">
                            <h3 class="snippet-title">File Cleanup Pattern</h3>
                            <div class="snippet-badges">
                                <span class="badge javascript">JavaScript</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> × ×™×§×•×™ ××•×˜×•××˜×™ ×©×œ ×§×‘×¦×™× ×™×©× ×™×
                        </div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>cleanupOldFiles(userId, maxAge = 24 * 60 * 60 * 1000) {
  try {
    const files = fs.readdirSync(this.outputDir);
    const now = Date.now();

    files.forEach(file => {
      const filePath = path.join(this.outputDir, file);
      const stats = fs.statSync(filePath);
      const age = now - stats.mtime.getTime();

      if (age > maxAge) {
        fs.unlinkSync(filePath);
        console.log(`ğŸ—‘ï¸ Deleted old file: ${file}`);
      }
    });
  } catch (error) {
    console.error('Error cleaning up:', error);
  }
}

// Keep only last N files per user
cleanupUserFiles(userId, keepCount = 5) {
  const files = fs.readdirSync(this.outputDir);
  const userFiles = files.filter(f => f.includes(`file_${userId}_`));
  
  if (userFiles.length > keepCount) {
    const sorted = userFiles
      .map(f => ({ name: f, time: fs.statSync(path.join(this.outputDir, f)).mtime.getTime() }))
      .sort((a, b) => a.time - b.time);

    sorted.slice(0, sorted.length - keepCount).forEach(file => {
      fs.unlinkSync(path.join(this.outputDir, file.name));
    });
  }
}</code></pre>
                        </div>
                    </div>
                </div>

                <!-- CATEGORY: Testing -->
                <div class="category" data-category="testing">
                    <div class="category-header">
                        <h2>ğŸ§ª ×‘×“×™×§×•×ª Pytest</h2>
                        <p>Fixtures, Parametrization, Async, Mocking</p>
                    </div>

                    <div class="snippet" data-tags="pytest fixture python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Fixture ×¢× Setup/Teardown</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> × ×™×§×•×™ ×¡×‘×™×‘×” ×œ×¤× ×™ ×•××—×¨×™ ×›×œ ×‘×“×™×§×”
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: tests/test_webapp_button_helpers.py:13-17</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>import pytest

@pytest.fixture(autouse=True)
def _clear_env(monkeypatch):
    """× ×™×§×•×™ ××©×ª× ×™ ×¡×‘×™×‘×” ×œ×¤× ×™ ×•××—×¨×™ ×›×œ ×‘×“×™×§×”"""
    # Setup
    monkeypatch.delenv('WEBAPP_URL', raising=False)

    yield  # ×”×‘×“×™×§×” ×¨×¦×” ×›××Ÿ

    # Teardown
    monkeypatch.delenv('WEBAPP_URL', raising=False)</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="pytest parametrize python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Test Parametrization</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×”×¨×¦×ª ××•×ª×” ×‘×“×™×§×” ×¢× ×›××” ×¡×˜×™× ×©×œ × ×ª×•× ×™×
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: tests/test_webapp_button_helpers.py:20-40</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>import pytest

@pytest.mark.parametrize(
    "config_values, env_value, expected",
    [
        (
            {"WEBAPP_URL": "https://cfg.example"},
            None,
            "https://cfg.example/file/abc"
        ),
        (
            {"WEBAPP_URL": None},
            "https://env.example",
            "https://env.example/file/abc"
        ),
    ],
)
def test_webapp_button(monkeypatch, config_values, env_value, expected):
    """×‘×•×“×§ ×©×”×›×¤×ª×•×¨ ×‘×•×—×¨ ××ª ×”××§×•×¨ ×”× ×›×•×Ÿ"""
    import handlers.file_view as fv

    # ×”×’×“×¨×ª config mock
    stub_cfg = types.SimpleNamespace(**config_values)
    monkeypatch.setattr(fv, 'config', stub_cfg, raising=False)

    # ×”×’×“×¨×ª env ×× × ×“×¨×©
    if env_value:
        monkeypatch.setenv('WEBAPP_URL', env_value)

    # ×”×¨×¦×ª ×”×¤×•× ×§×¦×™×”
    row = fv._get_webapp_button_row('abc', None)

    # ×‘×“×™×§×”
    assert row[0].url == expected</code></pre>
                        </div>
                    </div>

                    <div class="snippet" data-tags="pytest async python">
                        <div class="snippet-header">
                            <h3 class="snippet-title">Async Test</h3>
                            <div class="snippet-badges">
                                <span class="badge python">Python</span>
                            </div>
                        </div>
                        <div class="snippet-description">
                            ğŸ’¡ <strong>×œ××” ×–×” ×©×™××•×©×™:</strong> ×‘×“×™×§×ª ×¤×•× ×§×¦×™×•×ª async
                        </div>
                        <div class="snippet-location">ğŸ“ ××™×§×•×: tests/test_webserver_basic.py:5-25</div>
                        <div class="code-container">
                            <button class="copy-button" onclick="copyCode(this)">ğŸ“‹ ×”×¢×ª×§</button>
                            <pre><code>import pytest
from aiohttp import web
import aiohttp

@pytest.mark.asyncio
async def test_health_endpoint_ok(monkeypatch):
    """×‘×•×“×§ ×©×”-health endpoint ×¢×•×‘×“"""
    from services.webserver import create_app

    app = create_app()

    # ×”×¨×¦×ª server ×–×× ×™
    runner = web.AppRunner(app)
    await runner.setup()
    site = web.TCPSite(runner, host="127.0.0.1", port=0)
    await site.start()

    try:
        port = list(site._server.sockets)[0].getsockname()[1]

        async with aiohttp.ClientSession() as session:
            async with session.get(f"http://127.0.0.1:{port}/health") as resp:
                assert resp.status == 200
                data = await resp.json()
                assert data.get("status") == "ok"

    finally:
        await runner.cleanup()</code></pre>
                        </div>
                    </div>
                </div>

                <div class="no-results" id="noResults" style="display: none;">
                    <h3>ğŸ˜• ×œ× × ××¦××• ×ª×•×¦××•×ª</h3>
                    <p>× ×¡×” ××™×œ×•×ª ×—×™×¤×•×© ××—×¨×•×ª ××• ×¢×™×™×Ÿ ×‘×§×˜×’×•×¨×™×•×ª ×‘×¦×“</p>
                </div>
            </main>
        </div>

        <footer>
            <p>ğŸ“š × ×•×¦×¨ ××ª×•×š ××•×¡×£ ×§×•×“ ××¤×¨×•×™×§×˜×™×: CodeBot, Animals Rescue, Markdown Trainer</p>
            <p style="margin-top: 10px; opacity: 0.8;">×›×œ ×”×§×•×“ ××‘×•×¡×¡ ×¢×œ ×¤×¨×•×™×§×˜×™× ×××™×ª×™×™× ×•××•×›×—×™× ×‘×¤×¨×•×“×§×©×Ÿ</p>
        </footer>
    </div>

    <script>
        // Count snippets and categories
        const snippets = document.querySelectorAll('.snippet');
        const categories = document.querySelectorAll('.category');
        
        document.getElementById('totalSnippets').textContent = snippets.length;
        document.getElementById('totalCategories').textContent = categories.length;

        // Generate sidebar navigation
        const categoryNav = document.getElementById('categoryNav');
        categories.forEach((category, index) => {
            const header = category.querySelector('.category-header h2');
            const categoryName = header.textContent;
            const categoryId = `category-${index}`;
            category.id = categoryId;
            
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = `#${categoryId}`;
            a.textContent = categoryName;
            li.appendChild(a);
            categoryNav.appendChild(li);
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const mainContent = document.getElementById('mainContent');
        const noResults = document.getElementById('noResults');

        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm === '') {
                // Show all
                snippets.forEach(snippet => snippet.style.display = 'block');
                categories.forEach(category => category.style.display = 'block');
                noResults.style.display = 'none';
                return;
            }

            let visibleCount = 0;

            categories.forEach(category => {
                const categorySnippets = category.querySelectorAll('.snippet');
                let categoryHasVisible = false;

                categorySnippets.forEach(snippet => {
                    const title = snippet.querySelector('.snippet-title').textContent.toLowerCase();
                    const description = snippet.querySelector('.snippet-description').textContent.toLowerCase();
                    const code = snippet.querySelector('code').textContent.toLowerCase();
                    const tags = snippet.getAttribute('data-tags').toLowerCase();
                    
                    const matches = title.includes(searchTerm) || 
                                  description.includes(searchTerm) || 
                                  code.includes(searchTerm) ||
                                  tags.includes(searchTerm);

                    if (matches) {
                        snippet.style.display = 'block';
                        categoryHasVisible = true;
                        visibleCount++;
                    } else {
                        snippet.style.display = 'none';
                    }
                });

                category.style.display = categoryHasVisible ? 'block' : 'none';
            });

            noResults.style.display = visibleCount === 0 ? 'block' : 'none';
        });

        // Copy code functionality
        function copyCode(button) {
            const codeBlock = button.nextElementSibling.querySelector('code');
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'âœ… ×”×•×¢×ª×§!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            });
        }

        // Smooth scroll for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>
